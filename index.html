<!DOCTYPE html>
<html>
<head>
  <title>DNREC Shellfish Survey Map</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    #map {
      height: 90vh;
      width: 100%;
    }

    /* Zone list control styling */
    .zone-control {
      background: #fff;
      padding: 10px 12px;
      border-radius: 8px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.25);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 13px;
      line-height: 1.25;
      max-height: 220px;
      overflow: auto;
      min-width: 180px;
    }
    .zone-control .title {
      font-weight: 700;
      margin-bottom: 6px;
      font-size: 13px;
    }
    .zone-control ol {
      margin: 0;
      padding-left: 18px;
    }
    .zone-control li {
      margin: 2px 0;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    var map = L.map('map').setView([39.0, -75.45], 9);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // --- Zone list control (box on map) ---
    var zoneControl = L.control({ position: 'topright' });

    zoneControl.onAdd = function () {
      var div = L.DomUtil.create('div', 'zone-control');
      div.innerHTML = '<div class="title">Zones</div><ol id="zoneList"></ol>';

      // Prevent map drag/zoom when interacting with the box
      L.DomEvent.disableClickPropagation(div);
      L.DomEvent.disableScrollPropagation(div);
      return div;
    };

    zoneControl.addTo(map);

    function renderZoneList(zoneNames) {
      var listEl = document.getElementById('zoneList');
      if (!listEl) return;

      listEl.innerHTML = zoneNames.map(function (z) {
        return '<li>' + z + '</li>';
      }).join('');
    }

    // Load GeoJSON generated by Python
    fetch("data/clamming_polygons.geojson")
      .then(response => response.json())
      .then(data => {

        // Collect unique zone names
        var zoneSet = new Set();
        (data.features || []).forEach(function (f) {
          if (f && f.properties && f.properties.zone_name) {
            zoneSet.add(String(f.properties.zone_name));
          }
        });

        // Sort alphabetically (default)
        var zonesSorted = Array.from(zoneSet).sort(function (a, b) {
          return a.localeCompare(b);
        });

        // Render zone list
        renderZoneList(zonesSorted);

        // Add GeoJSON to map
        L.geoJSON(data, {
          style: function (feature) {
            if (feature.geometry.type === "Polygon" || feature.geometry.type === "MultiPolygon") {
              return {
                color: "#1f78b4",
                weight: 2,
                fillOpacity: 0.4
              };
            }
          },
          pointToLayer: function (feature, latlng) {
            // Bigger "place" icons
            return L.circleMarker(latlng, {
              radius: 10,          // was 5
              fillColor: "#e31a1c",
              color: "#fff",
              weight: 2,           // slightly thicker outline
              fillOpacity: 1
            });
          },
          onEachFeature: function (feature, layer) {
            const p = feature.properties || {};

            if (feature.geometry.type === "Polygon" || feature.geometry.type === "MultiPolygon") {
              layer.bindPopup(
                "<b>" + (p.zone_name ?? "") + "</b><br>" +
                "Site: " + (p.site_name ?? "") + "<br>" +
                "Polygon: " + (p.polygon_id ?? "")
              );
            }

            if (feature.geometry.type === "Point") {
              layer.bindPopup(
                "<b>" + (p.zone_name ?? "") + "</b><br>" +
                "Site: " + (p.site_name ?? "")
              );
            }
          }
        }).addTo(map);

      });
  </script>
</body>
</html>
